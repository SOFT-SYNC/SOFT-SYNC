<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link type="text/css" rel="stylesheet" href="../CSS/header.css">
    <link type="text/css" rel="stylesheet" href="../CSS/common.css">
    <link type="text/css" rel="stylesheet" href="../CSS/sidebar.css">
    <link type="text/css" rel="stylesheet" href="../CSS/invoice.css">
    <script type="text/javascript" src="../js/sidebar.js"></script>
    <script type="text/javascript" src="../js/orderList.js"></script>
</head>
<body>
<div th:insert="~{common/sidebar :: sidebar}"></div>
<div class="main-content">
    <div th:insert="~{common/header :: header}"></div>
    <div id="row1">
        <div class="head">
            <div class="left">
                품목코드 <input id="searchInput" type="text" placeholder="품목코드 입력">
                <button onclick="search()" class="blueBtn">검색</button>
            </div>
            <div class="right">
                <input type="date" id="date-start"> ~ <input type="date"
                                                             id="date-end">
            </div>
        </div>
        <form id="form1">
            <input type="hidden" id="page" name="page" value="1"> <!--page 값 넘기기-->
            <h1 class="visual-title">발주 리스트</h1>
            <div id="purchaseOrderListForm">
                <table>
                    <colgroup>
                        <col width="10%">
                        <col width="12%">
                        <col width="12%">
                        <col width="15%">
                        <col width="20%">
                        <col width="20%">
                        <col width="5%">
                    </colgroup>
                    <thead>
                    <tr>
                        <th>품목코드</th>
                        <th>발주일자</th>
                        <th>납기일</th>
                        <th>품명</th>
                        <th>발주수량</th>
                        <th>공급가액</th>
                        <th>검수현황</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="order : ${orders.content}">
                        <td th:text="${order.item.itemCode}"></td>
                        <td th:text="${order.orderDate}"></td>
                        <td th:text="${order.receiveDuedate}"></td>
                        <td th:text="${order.item.itemName}"></td>
                        <td th:text="${order.orderQuantity}"></td>
                        <td></td> <!-- 공급가액 -->
                        <td th:text="${order.receiptYn eq 'Y' ? '검수완료' : '검수대기'}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </form>
    </div>
</div>

<script>
    // 공급가액 자동 계산
    function calculateSupplyPrice() {
        // 모든 주문의 공급가액을 계산하여 저장할 변수
        let totalSupplyPrice = 0;

        // 각 주문에 대해 반복하여 공급가액을 계산합니다.
        document.querySelectorAll('#purchaseOrderListForm tbody tr').forEach(row => {
            // 각 행에서 발주수량과 단가를 가져옵니다.
            let orderQuantity = parseFloat(row.querySelector('td:nth-child(5)').textContent);
            let unitPrice = parseFloat(row.querySelector('td:nth-child(6)').textContent);
            // 발주수량과 단가를 곱하여 공급가액을 계산합니다.
            let supplyPrice = orderQuantity * unitPrice;
            // 계산된 공급가액을 해당 행의 공급가액 열에 표시합니다.
            row.querySelector('td:nth-child(6)').textContent = supplyPrice.toFixed(2);
            // 총 공급가액에 현재 행의 공급가액을 더합니다.
            totalSupplyPrice += supplyPrice;
        });

        // 총 공급가액을 반환합니다.
        return totalSupplyPrice.toFixed(2);
    }

    // 페이지가 로드될 때 공급가액을 계산하여 표시합니다.
    window.onload = function() {
        document.querySelector('#purchaseOrderListForm tbody').innerHTML = calculateSupplyPrice();
    };
</script>
</body>
</html>
