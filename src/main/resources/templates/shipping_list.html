<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>출고목록</title>
<link type="text/css" rel="stylesheet" href="css/header.css">
<link type="text/css" rel="stylesheet" href="css/common.css">
<link type="text/css" rel="stylesheet" href="css/sidebar.css">
<link type="text/css" rel="stylesheet" href="css/invoice.css">
</head>
<body>
	<div th:insert="~{sidebar :: sidebar}"></div>
	<div class="main-content">
		<div th:insert="~{header :: header}"></div>
		<div id="row1">
			<h1>출고목록</h1>
			<div class="search-container">
				<form id="searchForm"
					onsubmit="event.preventDefault(); performSearch();">
					<!-- 날짜 선택 영역 -->
					<div class="date-range">
						<label for="startDate"></label> <input type="date" id="startDate">
						<label for="endDate">~</label> <input type="date" id="endDate">
					</div>
					<!-- 검색 옵션과 필드 -->
					<div class="search-bar">
						<select id="filterSelect">
							<option value="itemCode">품목코드</option>
							<option value="itemName">품목명</option>
							<option value="productName">제품명</option>
							<option value="consumption">소요량</option>
							<option value="stock">재고수량</option>
						</select> <input type="text" id="searchInput" placeholder="검색...">
						<button type="button" onclick="performSearch()" class="blueBtn">검색</button>
					</div>
				</form>
				<!-- 결과 표시 테이블 -->
				<table id="resultsTable">
					<thead>
						<tr>
							<th>품목코드</th>
							<th>품목명</th>
							<th>제품명</th>
							<th>생산일자</th>
							<th>소요량</th>
							<th>재고수량</th>
							<th>출고수량</th>
						</tr>
					</thead>
					<tbody>
						<!-- 동적 결과 -->
					</tbody>
				</table>
				<div class="actions">
					<button type="button" onclick="publishSelected()" class="blueBtn">저장</button>
				</div>
			</div>
		</div>
	</div>
	<script>
    document.addEventListener('DOMContentLoaded', function() {
    loadDummyData();
});
function toggleSidenav() {
    const sidenav = document.querySelector('.sidenav');
    const mainContent = document.querySelector('.main-content');
    const sidenavToggle = document.querySelector('.sidenav-toggle');

    if (sidenav.style.left === '0px') {
        sidenav.style.left = '-200px'; // 사이드바 숨기기
        mainContent.style.marginLeft = '0'; // 메인 콘텐츠 원래 위치로
        sidenavToggle.style.left = '5px'; // 토글 버튼 원래 위치로
    } else {
        sidenav.style.left = '0'; // 사이드바 보이기
        mainContent.style.marginLeft = '200px'; // 메인 콘텐츠를 오른쪽으로 밀어냄
        sidenavToggle.style.left = '205px'; // 토글 버튼 오른쪽으로 이동
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // 드롭다운 버튼을 모두 선택합니다.
    var dropdowns = document.querySelectorAll('.dropdown-btn');

    // 각 버튼에 클릭 이벤트 리스너를 추가합니다.
    dropdowns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            // 모든 드롭다운 컨테이너를 닫습니다.
            closeAllDropdowns();

            // 현재 클릭된 버튼의 다음 요소(드롭다운 컨테이너)의 표시 상태를 토글합니다.
            var dropdownContainer = this.nextElementSibling;
            dropdownContainer.style.display = dropdownContainer.style.display === 'block' ? 'none' : 'block';
            
            // 클릭된 버튼에 'active' 클래스를 추가합니다.
            this.classList.toggle('active');
        });
    });

    // 모든 드롭다운을 닫는 함수
    function closeAllDropdowns() {
        var dropdownContainers = document.querySelectorAll('.dropdown-container');
        dropdownContainers.forEach(function(container) { 
            container.style.display = 'none';
        });
        
        // 모든 드롭다운 버튼에서 'active' 클래스를 제거합니다.
        dropdowns.forEach(function(btn) {
            btn.classList.remove('active');
        });
    }
});
const dummyData = [
    { id: 1, itemCode: "A001", itemName: "Item A", productName: "Product A", productionDate: "2022-05-01", consumption: 100, stock: 500 },
    { id: 2, itemCode: "B002", itemName: "Item B", productName: "Product B", productionDate: "2022-05-02", consumption: 150, stock: 600 },
    { id: 3, itemCode: "C003", itemName: "Item C", productName: "Product C", productionDate: "2022-05-03", consumption: 200, stock: 700 }
];

function loadDummyData(filteredData = dummyData) {
    const tbody = document.querySelector('#resultsTable tbody');
    tbody.innerHTML = '';
    filteredData.forEach(data => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${data.itemCode}</td>
            <td>${data.itemName}</td>
            <td>${data.productName}</td>
            <td>${data.productionDate}</td>
            <td>${data.consumption}</td>
            <td>${data.stock}</td>
            <td><input type="number" min="0" value="0" onchange="updateStock(this, ${data.id})"></td>
        `;
        tbody.appendChild(tr);
    });
}

function updateStock(input, id) {
    const item = dummyData.find(item => item.id === id);
    if (item) {
        const newStock = item.stock - parseInt(input.value);
        item.stock = newStock >= 0 ? newStock : 0; // Prevent stock from going negative
        loadDummyData(); // Reload table to reflect the updated stock
    }
}

function performSearch() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const filterSelect = document.getElementById('filterSelect').value;
    const searchText = document.getElementById('searchInput').value.toLowerCase();

    const filteredData = dummyData.filter(data => {
        let dateMatch = true;
        let textMatch = true;

        if (startDate || endDate) {
            const productionDate = new Date(data.productionDate);
            const start = startDate ? new Date(startDate) : new Date(-8640000000000000); // Min date
            const end = endDate ? new Date(endDate) : new Date(8640000000000000); // Max date
            dateMatch = productionDate >= start && productionDate <= end;
        }
        
        if (searchText && filterSelect) {
            textMatch = data[filterSelect] && data[filterSelect].toString().toLowerCase().includes(searchText);
        }
        
        return dateMatch && textMatch;
    });

    loadDummyData(filteredData);
}

function publishSelected() {
    console.log("Changes saved.");
    // Optionally, process data or communicate with a server here.
    dummyData.forEach(item => {
        console.log(`Item ID: ${item.id}, Stock: ${item.stock}`);
    });
    // Reset stock changes if necessary or finalize the changes
}
</script>
</body>
</html>