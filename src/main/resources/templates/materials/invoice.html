<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>거래명세서 조회</title>
<link type="text/css" rel="stylesheet" href="../css/header.css">
<link type="text/css" rel="stylesheet" href="../css/common.css">
<link type="text/css" rel="stylesheet" href="../css/sidebar.css">
<link type="text/css" rel="stylesheet" href="../css/invoice.css">
</head>
<body>
	<div th:insert="~{common/sidebar :: sidebar}"></div>
	<div class="main-content">
		<div th:insert="~{common/header :: header}"></div>
		<div id="row1">
			<h2 class="visual-title">거래명세서</h2>
			<div class="search-container">
				<form id="searchForm"
					onsubmit="event.preventDefault(); performSearch();">
					<!-- 날짜 선택 영역 -->
					<div class="date-range">
						<label for="startDate"></label> <input type="date" id="startDate">
						<label for="endDate">~</label> <input type="date" id="endDate">
					</div>
					<!-- 검색 옵션과 필드 -->
					<div class="search-bar">
						<select id="filterSelect">
							<option value="itemCode">품목코드</option>
							<option value="itemName">품목명</option>
							<option value="ProcurementNum">조달번호</option>
							<option value="OrderDate">발주일</option>
							<option value="CompanyName">업체명</option>
						</select> <input type="text" id="searchInput" placeholder="검색...">
						<button type="button" onclick="performSearch" class="blueBtn">검색</button>
					</div>
				</form>
				<!-- 결과 표시 테이블 -->
				<table id="resultsTable">
					<colgroup>
						<col width="5%">
						<col width="15%">
						<col width="15%">
						<col width="15%">
						<col width="15%">
						<col width="20%">
						<col width="20%">
					</colgroup>
					<thead>
						<tr>
							<th></th>
							<th>조달번호</th>
							<th>업체명</th>
							<th>품목코드</th>
							<th>품목명</th>
							<th>발주일</th>
							<th>입고처리일</th>
						</tr>
					</thead>
					<tbody>
						<!-- 동적 결과 -->
					</tbody>
				</table>
				<div class="actions">
					<button type="button" onclick="publishSelected()" class="blueBtn">발행</button>
				</div>
			</div>
		</div>
	</div>
	<script src="script.js"></script>
	<script>
    document.addEventListener('DOMContentLoaded', function() {
    loadDummyData();
});
function toggleSidenav() {
    const sidenav = document.querySelector('.sidenav');
    const mainContent = document.querySelector('.main-content');
    const sidenavToggle = document.querySelector('.sidenav-toggle');

    if (sidenav.style.left === '0px') {
        sidenav.style.left = '-200px'; // 사이드바 숨기기
        mainContent.style.marginLeft = '0'; // 메인 콘텐츠 원래 위치로
        sidenavToggle.style.left = '5px'; // 토글 버튼 원래 위치로
    } else {
        sidenav.style.left = '0'; // 사이드바 보이기
        mainContent.style.marginLeft = '200px'; // 메인 콘텐츠를 오른쪽으로 밀어냄
        sidenavToggle.style.left = '205px'; // 토글 버튼 오른쪽으로 이동
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // 드롭다운 버튼을 모두 선택합니다.
    var dropdowns = document.querySelectorAll('.dropdown-btn');

    // 각 버튼에 클릭 이벤트 리스너를 추가합니다.
    dropdowns.forEach(function(btn) {
        btn.addEventListener('click', function() {
            // 모든 드롭다운 컨테이너를 닫습니다.
            closeAllDropdowns();

            // 현재 클릭된 버튼의 다음 요소(드롭다운 컨테이너)의 표시 상태를 토글합니다.
            var dropdownContainer = this.nextElementSibling;
            dropdownContainer.style.display = dropdownContainer.style.display === 'block' ? 'none' : 'block';
            
            // 클릭된 버튼에 'active' 클래스를 추가합니다.
            this.classList.toggle('active');
        });
    });

    // 모든 드롭다운을 닫는 함수
    function closeAllDropdowns() {
        var dropdownContainers = document.querySelectorAll('.dropdown-container');
        dropdownContainers.forEach(function(container) { 
            container.style.display = 'none';
        });
        
        // 모든 드롭다운 버튼에서 'active' 클래스를 제거합니다.
        dropdowns.forEach(function(btn) {
            btn.classList.remove('active');
        });
    }
});
// document.addEventListener('DOMContentLoaded', function() {
//     // 드롭다운 버튼을 모두 선택합니다.
//     var dropdowns = document.querySelectorAll('.dropdown-btn');

//     // 각 버튼에 클릭 이벤트 리스너를 추가합니다.
//     dropdowns.forEach(function(btn) {
//         btn.addEventListener('click', function() {
//             // 현재 클릭된 버튼의 다음 요소(드롭다운 컨테이너)의 표시 상태를 토글합니다.
//             var dropdownContainer = this.nextElementSibling;
//             if (dropdownContainer.style.display === 'block') {
//                 dropdownContainer.style.display = 'none';
//             } else {
//                 dropdownContainer.style.display = 'block';
//             }
//         });
//     });
// });

const dummyData = [
    { id: 1, ProcurementNum: "1001", CompanyName: "Company A", itemCode: "IT001", itemName: "Item A", OrderDate: "2022-05-01", deliveryDate: "2022-05-05" },
    { id: 2, ProcurementNum: "1002", CompanyName: "Company B", itemCode: "IT002", itemName: "Item B", OrderDate: "2022-05-02", deliveryDate: "2022-05-06" },
    { id: 3, ProcurementNum: "1003", CompanyName: "Company C", itemCode: "IT003", itemName: "Item C", OrderDate: "2022-05-03", deliveryDate: "2022-05-07" }
];

function loadDummyData(filteredData = dummyData) {
    const tbody = document.querySelector('#resultsTable tbody');
    tbody.innerHTML = ''; // Clear previous rows
    filteredData.forEach(data => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><input type="checkbox" value="${data.id}"></td>
            <td>${data.ProcurementNum}</td>
            <td>${data.CompanyName}</td>
            <td>${data.itemCode}</td>
            <td>${data.itemName}</td>
            <td>${data.OrderDate}</td>
            <td>${data.deliveryDate}</td>
        `;
        tbody.appendChild(tr);
    });
}

function performSearch() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const filterSelect = document.getElementById('filterSelect').value;
    const searchText = document.getElementById('searchInput').value.toLowerCase();

    const filteredData = dummyData.filter(data => {
        const orderDate = new Date(data.orderDate);
        const start = new Date(startDate);
        const end = new Date(endDate);
        let textMatch = true;
        if (searchText) {
            textMatch = data[filterSelect].toString().toLowerCase().includes(searchText);
        }
        const dateMatch = (!startDate || orderDate >= start) && (!endDate || orderDate <= end);
        return textMatch && dateMatch;
    });

    loadDummyData(filteredData);
}

function publishSelected() {
    const selectedCheckbox = document.querySelector('#resultsTable tbody input[type="checkbox"]:checked');
    if (selectedCheckbox) {
        console.log("발행할 목록:", selectedCheckbox.value);
    } else {
        alert("선택된 항목이 없습니다.");
    }
}
</script>
</body>
</html>